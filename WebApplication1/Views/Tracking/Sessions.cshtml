@using Microsoft.AspNet.Identity;
@model IEnumerable<WebApplication1.Models.TrackingModel.TrackingState>

@{
    ViewBag.Title = "View";
    if (!Request.IsAuthenticated)
    {
        Response.Redirect("~/Account/Login?returnUrl="
            + Request.Url.LocalPath);
    }
}

<h1 data-user-id=@User.Identity.GetUserId()>Tracking Page</h1>
@{Html.RenderPartial("_MorrisLineChart"); }

<script>

    $(document).ready(function () {
        //alert(useridstring);
        getNum();
    });

    var user = document.getElementsByTagName("H1")[0].getAttribute("data-user-id");
    var iterate = 1;
    //alert(user);
    var x;
    function getNum() {
        $("#tablebod").empty();
        $.ajax({
            type: "GET",
            url: "http://localhost:4082/TrackingService.svc/Session/" + user + "",
            cache: false,
            dataType: "xml",
            success: function (xml) {
                $(xml).find('Session').each(function () {
                    var sessionID = $(this).find("UserId").text();
                
                });
            },
            complete: function () {
                x = document.getElementById("table").rows[table.rows.length - 1].cells[0].innerHTML;
                //setTimeout(getLatestNum(), 2000);
            }
        });
    }

</script>
<div id="trackingInfo">
    <ul class="timeline" id="stateTimeline"></ul>
    <table class="table table-striped table-bordered table-hover" id="table">

        <tr>
            <th>
                ID
            </th>
            <th>
                User ID
            </th>
            <th>
                # Alerts
            </th>
            <th>
                Location
            </th>
            <th>
                Temp
            </th>
            <th>
                Time
            </th>
        </tr>
        <tbody id="tablebod"></tbody>
    </table>
</div>